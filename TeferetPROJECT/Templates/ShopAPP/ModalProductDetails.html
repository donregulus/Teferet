{% load static %}

{% block content %}

<style>
  .box {
    width: 95px;
    border: 1px solid #8b0a0a6e;
    font-size: 16px;
    color: #1c87c9;
    background-color: #02350d;
    border-radius: 15px;
  }
</style>

<div class="wrap-modal1 js-modal1 p-t-60 p-b-20">
  <div class="overlay-modal1 js-hide-modal1"></div>

  <div class="container">
    <div class="bg0 p-t-60 p-b-30 p-lr-15-lg how-pos3-parent">
      <button class="how-pos3 hov3 trans-04 js-hide-modal1">
        <img src="{% static './images/icons/icon-close.png' %}" alt="CLOSE" />
      </button>

      <div class="row">
        <div class="col-md-6 col-lg-7 p-b-30">
          <div class="p-l-25 p-r-30 p-lr-0-lg">
            <div class="wrap-slick3 flex-sb flex-w">
              <div class="wrap-slick3-dots"></div>
              <div class="wrap-slick3-arrows flex-sb-m flex-w"></div>

              <div class="slick3 gallery-lb">
                <div class="item-slick3" data-thumb="{{product.image.url}}">
                  <div class="detailPic pos-relative">
                    <img src="{{product.image.url}}" alt="IMG-PRODUCT" />

                    <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04"
                      href="{{product.image.url}}">
                      <i class="fa fa-expand"></i>
                    </a>
                  </div>
                </div>

                {% for proImg in ProductImages %}
                <div class="item-slick3" data-thumb="{{proImg.image.url}}">
                  <div class="wrap-pic-w pos-relative">
                    <img src="{{proImg.image.url}}" alt="IMG-PRODUCT" />

                    <a class="flex-c-m size-108 how-pos1 bor0 fs-16 cl10 bg0 hov-btn3 trans-04" target="_blank"
                      href="{{proImg.image.url}}">
                      <i class="fa fa-expand"></i>
                    </a>
                  </div>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-5 p-b-30">
          <div class="p-r-50 p-t-5 p-lr-0-lg">
            <h4 class="mtext-105 cl2 js-name-detail p-b-14">
              {{product.name}}
            </h4>



            <p class="stext-102 cl3 p-t-23">{{product.description}}</p>

            <!--  -->
            {% if product.stock > 0 %}
            <div class="p-t-33">
              {% if product.variation_set.sizes|length > 0 %}
              <div class="flex-w flex-r-m p-b-10">
                <div class="size-203 flex-c-m respon6">
                  Size
                </div>

                <div class="size-204 respon6-next">
                  <div class="rs1-select2 bor8 bg0 box">
                    <select class="js-select2" id="sizeSelected">
                      <option value="">-----</option>
                      {% for i in product.variation_set.sizes %}
                      {% if i.variation_value == variation %}
                      <option value="{{i.variation_value}}" selected="selected">
                        {{i.variation_value}}
                      </option>
                      {% else %}
                      <option value="{{i.variation_value}}">{{i.variation_value}}
                      </option>
                      {% endif %}
                      {% endfor %}
                    </select>
                    <div class="dropDownSelect2"></div>
                  </div>
                </div>
              </div>
              {% endif %}

              <!-- <div class="flex-w flex-r-m p-b-10">
                <div class="size-203 flex-c-m respon6">Color</div>

                <div class="size-204 respon6-next">
                  <div class="rs1-select2 bor8 bg0">
                    <select class="js-select2" name="time">
                      <option>Choose an option</option>
                      <option>Red</option>
                      <option>Blue</option>
                      <option>White</option>
                      <option>Grey</option>
                    </select>
                    <div class="dropDownSelect2"></div>
                  </div>
                </div>
              </div> -->

              <div class="flex-w flex-r-m p-b-10">
                <div class="size-204 flex-w flex-m respon6-next" id="shoppingDetails" data-id={{product.pid}}>
                  {% if quantity == 0 %}

                  <button style="margin-top: 10px;"
                    class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart-detail"
                    data-id={{product.pid}}>
                    Add to cart
                  </button>


                  {% else %}
                  <div class="wrap-num-product flex-w m-r-20 m-tb-10">
                    <div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m" data-id={{product.pid}}>
                      <i class="fs-16 zmdi zmdi-minus"></i>
                    </div>

                    <input class="mtext-104 cl3 txt-center num-product" name="num-product" value={{quantity}}
                      data-id={{product.pid}}>

                    <div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m" data-id={{product.pid}}>
                      <i class="fs-16 zmdi zmdi-plus"></i>
                    </div>
                  </div>

                  <button class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 DeleteProduct"
                    data-id={{product.pid}}>
                    Remove
                  </button>
                  {% endif %}
                </div>
              </div>
            </div>
            {% else %}
            <h3 style="text-align: center; margin-top: 40px;">OUT OF STOCK</h3>
            {% endif %}
          </div>

          <!--  -->
          <div class="flex-w flex-m p-l-100 p-t-40 respon7">
            <div class="flex-m bor9 p-r-10 m-r-11">
              <a href="#" class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 js-addwish-detail tooltip100"
                data-tooltip="Add to Wishlist">
                <i class="zmdi zmdi-favorite"></i>
              </a>
            </div>

            <a href="#" class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100" data-tooltip="Facebook">
              <i class="fa fa-facebook"></i>
            </a>

            <a href="#" class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100" data-tooltip="Twitter">
              <i class="fa fa-twitter"></i>
            </a>

            <a href="#" class="fs-14 cl3 hov-cl1 trans-04 lh-10 p-lr-5 p-tb-2 m-r-8 tooltip100"
              data-tooltip="Google Plus">
              <i class="fa fa-google-plus"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
  $(".js-hide-modal1").on("click", function () {
    $(".js-modal1").removeClass("show-modal1");
  });

  $('#shoppingDetails').on('click', '.js-addcart-detail', function (e) {
    var nameProduct = $(this).parent().parent().parent().parent().find('.js-name-detail').html();
    let size = null;

    if ($("#sizeSelected").length && $("#sizeSelected").val().trim().length === 0) {

      swal("Oops", "Choose a size for :" + nameProduct, "error");
    }
    else {
      swal(nameProduct, "is added to cart !", "success");
      var productId = $(this).data('id');


      let SizeOject = {}

      if ($("#sizeSelected").length) {
        SizeOject.size = $("#sizeSelected").val()
      }


      let url = "{% url 'ShopAPP:AddProduct' 'pid' %}".replace('pid', productId);
      // AJAX request
      $.ajax({
        url: url,
        data: SizeOject,
        type: 'get',
        success: function (response) {
          $("#cartNum").attr("data-notify", response);
          $("#shoppingDetails").empty()
          var addProductNumber = $(
            '<div class="wrap-num-product flex-w m-r-20 m-tb-10">' +
            '<div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m" data-id=' + productId + '>' +
            '<i class="fs-16 zmdi zmdi-minus"></i>' +
            '</div>' +
            '<input class="mtext-104 cl3 txt-center num-product" type="text" name="num-product1" value=1 data-id=' + productId + '>' +
            '<div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m"  data-id=' + productId + '>' +
            '<i class="fs-16 zmdi zmdi-plus"></i>' +
            '</div>' +
            '</div>' +

            '<button class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 DeleteProduct" data-id=' + productId + '>' +
            'Remove' +
            '</button>'
          )
          $("#shoppingDetails").append(addProductNumber)
        }
      });
    }
  });

  $('#shoppingDetails').on('click', '.DeleteProduct', function (e) {

    e.stopPropagation();
    e.stopImmediatePropagation();
    var productId = $(this).data('id');
    let url = "{% url 'ShopAPP:DeleteProduct' 'pid' %}".replace('pid', productId);

    let SizeOject = {}
    if ($("#sizeSelected").length) {
      SizeOject.size = $("#sizeSelected").val()
    }
    // AJAX request
    $.ajax({
      url: url,
      data: SizeOject,
      type: 'get',
      success: function (response) {
        $("#cartNum").attr("data-notify", response);
        $("#shoppingDetails").empty()

        var addProductNumber = $('<button style="margin-top: 10px;" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart-detail" data-id=' + productId + '>' +
          'Add to cart' +
          '</button>'
        )
        $("#shoppingDetails").append(addProductNumber)
      }
    });
  });

  $('#shoppingDetails').on('click', '.btn-num-product-up', function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    var numProduct = Number($(this).prev().val());
    $(this).prev().val(numProduct + 1);

    var productId = $(this).data('id');

    let SizeOject = {}

    if ($("#sizeSelected").length) {
      SizeOject.size = $("#sizeSelected").val()
    }


    let url = "{% url 'ShopAPP:AddProduct' 'pid' %}".replace('pid', productId);

    // // AJAX request
    $.ajax({
      url: url,
      type: 'get',
      data: SizeOject,
      success: function (response) {
        $("#cartNum").attr("data-notify", response);
      },
      error: function (response) {
        $(".num-product").val(response.responseJSON.prodNumCart);
        swal("Oops", response.responseJSON.error, "error");
      }
    });
  });

  $('#shoppingDetails').on('click', '.btn-num-product-down', function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    var numProduct = Number($(this).next().val());
    if (numProduct > 1) $(this).next().val(numProduct - 1);

    if (numProduct > 1) {
      var productId = $(this).data('id');

      let url = "{% url 'ShopAPP:RemoveProduct' 'pid' %}".replace('pid', productId);

      let SizeOject = {}
      if ($("#sizeSelected").length) {
        SizeOject.size = $("#sizeSelected").val()
      }
      // // AJAX request
      $.ajax({
        url: url,
        data: SizeOject,
        type: 'get',
        success: function (response) {
          $("#cartNum").attr("data-notify", response);

        }
      });
    }
  });

  $('#shoppingDetails').on('input', '.num-product', function (e) {
    this.value = this.value.replace(/[^\d]+|^0+(?!$)/g, '').replace(/(\..*)\./g, '$1');
  });

  $('#shoppingDetails').on('change', '.num-product', function (e) {
    e.stopPropagation();
    e.stopImmediatePropagation();
    var numProduct = Number($(this).val());

    if (numProduct === 0) {
      $(this).val(1);
      var numProduct = 1
    }


    let SizeOject = {}
    if ($("#sizeSelected").length) {
      SizeOject.size = $("#sizeSelected").val()
    }

    var productId = $(this).data('id');
    console.log(productId)
    let url = "{% url 'ShopAPP:AddProducts' 'pid' 'numProduct' %}".replace('pid', productId).replace('numProduct', numProduct);

    // // AJAX request
    $.ajax({
      url: url,
      data: SizeOject,
      type: 'get',
      success: function (response) {
        $("#cartNum").attr("data-notify", response);
      },
      error: function (response) {
        $(".num-product").val(response.responseJSON.prodNumCart);
        swal("Oops", response.responseJSON.error, "error");
      }
    });
  });

  $("#sizeSelected").change(function () {

    var productId = $("#shoppingDetails").data('id');
    let url = "{% url 'ShopAPP:UpdateVariation' 'pid' %}".replace('pid', productId);

    let SizeOject = {}
    SizeOject.size = $(this).val();

    // // AJAX request
    $.ajax({
      url: url,
      type: 'get',
      data: SizeOject,
      success: function (response) {

        if (Number(response) === 0) {

          $("#shoppingDetails").empty()
          var addProductNumber = $('<button style="margin-top: 10px;" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 js-addcart-detail" data-id=' + productId + '>' +
            'Add to cart' +
            '</button>'
          )
          $("#shoppingDetails").append(addProductNumber)
        }
        else {

          $("#shoppingDetails").empty()
          var addProductNumber = $(
            '<div class="wrap-num-product flex-w m-r-20 m-tb-10">' +
            '<div class="btn-num-product-down cl8 hov-btn3 trans-04 flex-c-m" data-id=' + productId + '>' +
            '<i class="fs-16 zmdi zmdi-minus"></i>' +
            '</div>' +
            '<input class="mtext-104 cl3 txt-center num-product" type="text" name="num-product1" value=' + response + ' data-id=' + productId + '>' +
            '<div class="btn-num-product-up cl8 hov-btn3 trans-04 flex-c-m"  data-id=' + productId + '>' +
            '<i class="fs-16 zmdi zmdi-plus"></i>' +
            '</div>' +
            '</div>' +

            '<button class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04 DeleteProduct" data-id=' + productId + '>' +
            'Remove' +
            '</button>'
          )
          $("#shoppingDetails").append(addProductNumber)
        }

      }
    });
  });




</script>

{% endblock %}